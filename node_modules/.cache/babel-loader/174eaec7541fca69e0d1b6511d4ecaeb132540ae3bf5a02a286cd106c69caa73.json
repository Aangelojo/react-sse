{"ast":null,"code":"var _jsxFileName = \"/Users/hayden/Documents/react/sse-demo/src/components/SSEProgress.tsx\",\n  _s = $RefreshSig$();\n// src/components/SSEProgress.tsx\nimport React, { useState, useEffect } from \"react\";\nimport { useSSE } from \"../hooks/useSSE\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SSEProgress = () => {\n  _s();\n  const [taskId, setTaskId] = useState(null);\n  const [progress, setProgress] = useState(0);\n  const [status, setStatus] = useState(\"等待任务\");\n  const sseUrl = import.meta.env.VITE_API_URL || \"http://localhost:3000/api\";\n  const {\n    data,\n    error\n  } = useSSE(\"sse\", {\n    path: sseUrl,\n    disabled: !sseUrl\n  });\n\n  // 触发任务\n  const startTask = async () => {\n    const response = await fetch(`${import.meta.env.VITE_API_URL}/start-task`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        data: \"test data\"\n      })\n    });\n    const result = await response.json();\n    setTaskId(result.task_id);\n    setStatus(\"处理中\");\n  };\n\n  // 监听SSE数据\n  useEffect(() => {\n    if (data) {\n      setProgress(data.progress);\n      setStatus(data.status);\n      if (data.status === \"completed\") {\n        setTaskId(null);\n      }\n    }\n  }, [data]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"sse-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startTask,\n      disabled: !!taskId,\n      children: taskId ? \"任务进行中...\" : \"启动任务\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"progress-bar\",\n      style: {\n        width: `${progress}%`\n      },\n      children: [progress, \"%\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"status\",\n      children: status\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 5\n  }, this);\n};\n_s(SSEProgress, \"8JK55WoKRWweJxAv9A75UPG9fP4=\", false, function () {\n  return [useSSE];\n});\n_c = SSEProgress;\nexport default SSEProgress;\nvar _c;\n$RefreshReg$(_c, \"SSEProgress\");","map":{"version":3,"names":["React","useState","useEffect","useSSE","jsxDEV","_jsxDEV","SSEProgress","_s","taskId","setTaskId","progress","setProgress","status","setStatus","sseUrl","import","meta","env","VITE_API_URL","data","error","path","disabled","startTask","response","fetch","method","headers","body","JSON","stringify","result","json","task_id","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","style","width","_c","$RefreshReg$"],"sources":["/Users/hayden/Documents/react/sse-demo/src/components/SSEProgress.tsx"],"sourcesContent":["// src/components/SSEProgress.tsx\nimport React, { useState, useEffect } from \"react\";\nimport { useSSE } from \"../hooks/useSSE\";\n\ninterface ProgressData {\n  progress: number;\n  status: string;\n  timestamp: number;\n}\n\nconst SSEProgress: React.FC = () => {\n  const [taskId, setTaskId] = useState<string | null>(null);\n  const [progress, setProgress] = useState(0);\n  const [status, setStatus] = useState(\"等待任务\");\n\n  const sseUrl = import.meta.env.VITE_API_URL || \"http://localhost:3000/api\";\n\n  const { data, error } = useSSE<ProgressData>(\"sse\", {\n    path: sseUrl,\n    disabled: !sseUrl,\n  });\n\n  // 触发任务\n  const startTask = async () => {\n    const response = await fetch(`${import.meta.env.VITE_API_URL}/start-task`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ data: \"test data\" }),\n    });\n    const result = await response.json();\n    setTaskId(result.task_id);\n    setStatus(\"处理中\");\n  };\n\n  // 监听SSE数据\n  useEffect(() => {\n    if (data) {\n      setProgress(data.progress);\n      setStatus(data.status);\n      if (data.status === \"completed\") {\n        setTaskId(null);\n      }\n    }\n  }, [data]);\n\n  return (\n    <div className=\"sse-container\">\n      <button onClick={startTask} disabled={!!taskId}>\n        {taskId ? \"任务进行中...\" : \"启动任务\"}\n      </button>\n      <div className=\"progress-bar\" style={{ width: `${progress}%` }}>\n        {progress}%\n      </div>\n      <div className=\"status\">{status}</div>\n    </div>\n  );\n};\n\nexport default SSEProgress;\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,SAASC,MAAM,QAAQ,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAQzC,MAAMC,WAAqB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAClC,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGR,QAAQ,CAAgB,IAAI,CAAC;EACzD,MAAM,CAACS,QAAQ,EAAEC,WAAW,CAAC,GAAGV,QAAQ,CAAC,CAAC,CAAC;EAC3C,MAAM,CAACW,MAAM,EAAEC,SAAS,CAAC,GAAGZ,QAAQ,CAAC,MAAM,CAAC;EAE5C,MAAMa,MAAM,GAAGC,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,IAAI,2BAA2B;EAE1E,MAAM;IAAEC,IAAI;IAAEC;EAAM,CAAC,GAAGjB,MAAM,CAAe,KAAK,EAAE;IAClDkB,IAAI,EAAEP,MAAM;IACZQ,QAAQ,EAAE,CAACR;EACb,CAAC,CAAC;;EAEF;EACA,MAAMS,SAAS,GAAG,MAAAA,CAAA,KAAY;IAC5B,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGV,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,aAAa,EAAE;MACzEQ,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB,CAAC;MAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAEX,IAAI,EAAE;MAAY,CAAC;IAC5C,CAAC,CAAC;IACF,MAAMY,MAAM,GAAG,MAAMP,QAAQ,CAACQ,IAAI,CAAC,CAAC;IACpCvB,SAAS,CAACsB,MAAM,CAACE,OAAO,CAAC;IACzBpB,SAAS,CAAC,KAAK,CAAC;EAClB,CAAC;;EAED;EACAX,SAAS,CAAC,MAAM;IACd,IAAIiB,IAAI,EAAE;MACRR,WAAW,CAACQ,IAAI,CAACT,QAAQ,CAAC;MAC1BG,SAAS,CAACM,IAAI,CAACP,MAAM,CAAC;MACtB,IAAIO,IAAI,CAACP,MAAM,KAAK,WAAW,EAAE;QAC/BH,SAAS,CAAC,IAAI,CAAC;MACjB;IACF;EACF,CAAC,EAAE,CAACU,IAAI,CAAC,CAAC;EAEV,oBACEd,OAAA;IAAK6B,SAAS,EAAC,eAAe;IAAAC,QAAA,gBAC5B9B,OAAA;MAAQ+B,OAAO,EAAEb,SAAU;MAACD,QAAQ,EAAE,CAAC,CAACd,MAAO;MAAA2B,QAAA,EAC5C3B,MAAM,GAAG,UAAU,GAAG;IAAM;MAAA6B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACvB,CAAC,eACTnC,OAAA;MAAK6B,SAAS,EAAC,cAAc;MAACO,KAAK,EAAE;QAAEC,KAAK,EAAE,GAAGhC,QAAQ;MAAI,CAAE;MAAAyB,QAAA,GAC5DzB,QAAQ,EAAC,GACZ;IAAA;MAAA2B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC,eACNnC,OAAA;MAAK6B,SAAS,EAAC,QAAQ;MAAAC,QAAA,EAAEvB;IAAM;MAAAyB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACnC,CAAC;AAEV,CAAC;AAACjC,EAAA,CA9CID,WAAqB;EAAA,QAODH,MAAM;AAAA;AAAAwC,EAAA,GAP1BrC,WAAqB;AAgD3B,eAAeA,WAAW;AAAC,IAAAqC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}